"use strict";(self.webpackChunkterra_website=self.webpackChunkterra_website||[]).push([[4818],{7851:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"standard-library/package-managing/intro","title":"Managing project dependencies","description":"Terra\u2019s package manager - Cosm along with its command-line interface cosm - is designed to make managing project dependencies easier when projects grow. It lets you install, manage, and share packages reliably, ensuring your builds are consistent every time. One cool feature is it doesn\u2019t need lockfiles, thanks to minimal version selection, which helps keep things reproducible. It\u2019s also easy to extend for new languages with simple plugins, and its Git-like CLI feels familiar if you\u2019re used to version control. Whether you\u2019re handling public or private package registries, Cosm is a handy tool for organizing dependencies and collaborating on complex projects.","source":"@site/docs/standard-library/package-managing/intro.md","sourceDirName":"standard-library/package-managing","slug":"/standard-library/package-managing/intro","permalink":"/terra-website/docs/standard-library/package-managing/intro","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/standard-library/package-managing/intro.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Parallel test-runner","permalink":"/terra-website/docs/standard-library/unit-testing/parallel-test-suites"}}');var r=n(4848),i=n(8453);const t={},o="Managing project dependencies",l={},c=[{value:"Installation",id:"installation",level:2},{value:"Versioning",id:"versioning",level:2},{value:"Minimal version selection",id:"minimal-version-selection",level:2},{value:"get status of a package or registry",id:"get-status-of-a-package-or-registry",level:2},{value:"instantiate a new package",id:"instantiate-a-new-package",level:2},{value:"Activate a package",id:"activate-a-package",level:2},{value:"instantiate a new registry / delete a registry / update a registry",id:"instantiate-a-new-registry--delete-a-registry--update-a-registry",level:2},{value:"Add project dependencies",id:"add-project-dependencies",level:2},{value:"Remove project dependencies",id:"remove-project-dependencies",level:2},{value:"Upgrade project dependencies",id:"upgrade-project-dependencies",level:2},{value:"Develop a project dependency",id:"develop-a-project-dependency",level:2},{value:"downgrade project dependencies",id:"downgrade-project-dependencies",level:2},{value:"register a new release of a project",id:"register-a-new-release-of-a-project",level:2},{value:"Register a project to a registry",id:"register-a-project-to-a-registry",level:2},{value:"Remove a version or project from a registry",id:"remove-a-version-or-project-from-a-registry",level:2}];function d(e){const a={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.header,{children:(0,r.jsx)(a.h1,{id:"managing-project-dependencies",children:"Managing project dependencies"})}),"\n",(0,r.jsx)(a.p,{children:"Terra\u2019s package manager - Cosm along with its command-line interface cosm - is designed to make managing project dependencies easier when projects grow. It lets you install, manage, and share packages reliably, ensuring your builds are consistent every time. One cool feature is it doesn\u2019t need lockfiles, thanks to minimal version selection, which helps keep things reproducible. It\u2019s also easy to extend for new languages with simple plugins, and its Git-like CLI feels familiar if you\u2019re used to version control. Whether you\u2019re handling public or private package registries, Cosm is a handy tool for organizing dependencies and collaborating on complex projects."}),"\n",(0,r.jsxs)(a.blockquote,{children:["\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"Caution"}),": Cosm is a prototype and not yet optimized for production use. While feature-complete, its API is not finalized and may evolve, potentially breaking compatibility. Additionally, performance can degrade significantly due to the current implementation in Lua."]}),"\n"]}),"\n",(0,r.jsx)(a.h1,{id:"cosm---package-manager",children:"Cosm - package manager"}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"Cosm"})," and its associated command-line-interface ",(0,r.jsx)(a.code,{children:"cosm"}),", is a package manager and integrated package registry that is language agnostic. Support for new languages is implemented by writing a simple plugin. This makes ",(0,r.jsx)(a.code,{children:"Cosm"})," ideally suited for multi-language projects."]}),"\n",(0,r.jsxs)(a.p,{children:["The design of ",(0,r.jsx)(a.code,{children:"Cosm"})," is based on the following ideas"]}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.a,{href:"https://research.swtch.com/vgo-mvs",children:"Minimal version selection"}),", leading to 100% reproducible builds without the need for a lockfile."]}),"\n",(0,r.jsx)(a.li,{children:"Clear division of: (1) a language agnostic core functionality for package management, and (2) a language/build system specific top-layer that is extensible."}),"\n",(0,r.jsx)(a.li,{children:"Integrated tools for package registries, allowing both publicly and privately hosted package registries, using the same interface."}),"\n",(0,r.jsx)(a.li,{children:"A local depot directory (.cosm) that locally hosts registry and package data and interacts with remotes when required."}),"\n",(0,r.jsxs)(a.li,{children:["A command-line-interface that is easy and feels like ",(0,r.jsx)(a.code,{children:"git"}),"."]}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:"Currently the following languags are supported through plugins"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"https://www.lua.org/",children:"Lua"})}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"https://terralang.org/",children:"Terra"})}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:["Some of these ideas have been drawn from my experiences with the ",(0,r.jsx)(a.a,{href:"https://pkgdocs.julialang.org/v1/",children:"Julia package manager"})," and the excellent set of ",(0,r.jsx)(a.a,{href:"https://research.swtch.com/vgo",children:"blog posts"})," from Ross Cox on package management in Go. ",(0,r.jsx)(a.code,{children:"Cosm"})," naturally features reproducible builds without the need for a lock file. Instead, the dependency tree is evaluated just in time based on a simple criterion. The result is a relatively simple core design that is language agnostic. Specific Language or build system support can be added via simple plugins."]}),"\n",(0,r.jsx)(a.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsxs)(a.p,{children:["Currently, ",(0,r.jsx)(a.code,{children:"Cosm"})," depends on ",(0,r.jsx)(a.a,{href:"https://www.lua.org/",children:"Lua"})," and bash. Simply download and run the ",(0,r.jsx)(a.code,{children:"install.sh"})," script. Try the following to check that calling ",(0,r.jsx)(a.code,{children:"cosm"})," is successful"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm --version\n"})}),"\n",(0,r.jsx)(a.h2,{id:"versioning",children:"Versioning"}),"\n",(0,r.jsxs)(a.p,{children:["Consequent versioning is central to good package management. We follow the rules in ",(0,r.jsx)(a.a,{href:"https://semver.org/",children:"Semantic Versioning 2.0.0"})," and utilize the ",(0,r.jsx)(a.a,{href:"https://github.com/kikito/semver.lua",children:"semver.lua"})," library. In ",(0,r.jsx)(a.code,{children:"cosm"}),", a specific instance of a package is uniquely defined by"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{children:"    <name>@v<major>.<minor>.<patch>-<prerelease>+<build>\n"})}),"\n",(0,r.jsxs)(a.p,{children:["Packages with different major version numbers are considered as different packages. You can even use ",(0,r.jsx)(a.code,{children:"<name>@v0"})," and ",(0,r.jsx)(a.code,{children:"<name>@v1"})," in the same project. This could be useful when you want to move slowly to a new stable release. Simply add ",(0,r.jsx)(a.code,{children:"<name>@v1"}),", import its functionality inside a new namespace, and start migrating some of the api calls from ",(0,r.jsx)(a.code,{children:"<name>@v0"})," to ",(0,r.jsx)(a.code,{children:"<name>@v1"}),"."]}),"\n",(0,r.jsx)(a.h2,{id:"minimal-version-selection",children:"Minimal version selection"}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.a,{href:"https://research.swtch.com/vgo-mvs",children:"Minimal version selection"})," provides a consistent and simple approach to package management that leads to 100% reproducible build without the need for a lockfile. It works as follows:"]}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsx)(a.li,{children:"Each project provides minimal versions of each dependency."}),"\n",(0,r.jsx)(a.li,{children:"The algorithm inspects versions of all transitive dependencies and takes the maximum of the minimum versions for each encountered dependency."}),"\n",(0,r.jsx)(a.li,{children:"If you want to work with newer versions you can adjust, locally, the minimal requirments of a dependency, which then overrides the minimal version of said project."}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:"In cosm all of this is encapsulated in a simple set of commands, see below for the API."}),"\n",(0,r.jsx)(a.h2,{id:"get-status-of-a-package-or-registry",children:"get status of a package or registry"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm status\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Gives an overview of a package when evaluated in the root of a package. Direct dependencies are denoted in bold blue."})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm registry status <registry name>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Gives an overview of the packages registered to the registry. Can be evaluated anywhere."})}),"\n",(0,r.jsx)(a.h2,{id:"instantiate-a-new-package",children:"instantiate a new package"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm init <package name>\ncosm init <package name> --language <language>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsxs)(a.em,{children:["Evaluate in root directory of an existing project. A 'Project.lua' file is created for project package name and, optionally, language ",(0,r.jsx)(a.code,{children:"<language>"}),", which defaults to Lua."]})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm init <package name> --template <language/template>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Evaluate in parent folder of a new package. Adds a new package with name package name according to a template (in .cosm/lang). Currently, only a lua and terra template are implemented."})}),"\n",(0,r.jsx)(a.h2,{id:"activate-a-package",children:"Activate a package"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm activate\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"An interactive environment is loaded, which initialized all environment variables needed for dependency management. The interactive prompt looks like"})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"You can now run your project, e.g."})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm> lua src/<module name>.lua\n"})}),"\n",(0,r.jsx)(a.h2,{id:"instantiate-a-new-registry--delete-a-registry--update-a-registry",children:"instantiate a new registry / delete a registry / update a registry"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm registry init <registry name> <giturl>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Adds a new package registry with name name (in .cosm/registries) with remote located at giturl. The giturl should point to an empty remote git repository."})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm registry clone <giturl>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Adds an existing package registry (in .cosm/registries) with remote located at giturl. The giturl should point to a valid existing package registry."})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm registry delete <registry name> [--force]\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Remove a registry from .cosm/registries."})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm registry update <registry name>\ncosm registry update --all\n"})}),"\n",(0,r.jsx)(a.p,{children:"Update and synchronize registry with the remote."}),"\n",(0,r.jsx)(a.h2,{id:"add-project-dependencies",children:"Add project dependencies"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm add <name> v<version>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Evaluate in a package root. Add a dependency to a project. Project name with version version will be looked up in any of the available local registries. If a package with the same name exists in multiple registries then the user will be prompted to choose the registry from the available listed registries."})}),"\n",(0,r.jsx)(a.h2,{id:"remove-project-dependencies",children:"Remove project dependencies"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm rm <name>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Evaluate in a package root. Removes a project dependency."})}),"\n",(0,r.jsx)(a.h2,{id:"upgrade-project-dependencies",children:"Upgrade project dependencies"}),"\n",(0,r.jsx)(a.p,{children:"You can upgrade any direct or transitive dependency separately using one of the following commands:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm upgrade <name>\ncosm upgrade <name> v<x>\ncosm upgrade <name> v<x.y>\ncosm upgrade <name> v<x.y.z>\ncosm upgrade <name> v<x.y.z-alpha>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Evaluate in a package root. Upgrading is done conservatively, meaning that the latest compatible version is chosen by default that satisfies the provided constraint. For example,"})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm upgrade <name> v<x.y>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Upgrades a package to version 'x.y.z' where z is the latest patch version in the series. If you want to upgrade to an exact version then you simply specify the constraint"})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm upgrade <name> v<x.y.z>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"The '--latest' option changes the default behavior and pickes the latest registered version of the package."})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm upgrade <name> --latest\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"If you want to upgrade all direct and transitive project dependencies you can use one of the following commands."})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm upgrade --all\ncosm upgrade --all --latest\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsxs)(a.em,{children:["By default, an upgrade seeks the latest compatible version. The ",(0,r.jsx)(a.code,{children:"--latest"})," option is used to get the latest of each package, which may be incompatible with the current version you are using. The order of the options is not relevant."]})}),"\n",(0,r.jsx)(a.h2,{id:"develop-a-project-dependency",children:"Develop a project dependency"}),"\n",(0,r.jsx)(a.p,{children:"Its possible to extend functionality or fix bugs in one of your managed dependencies and directly use it in your parent project without issuing new releases of your dependency. This is particularly useful at early development stages and simply works as follows"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm develop <package name>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsxs)(a.em,{children:["Evaluate in a package root. Open a dependency to a project, but in development mode, which means it checks out a 'git clone' of the latest version of package name in ",(0,r.jsx)(a.code,{children:"cosm/dev/<package name>@v<major>"})," that you can freely develop in. The changes are imediately available in your parent project."]})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm free <package name>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Evaluate in a package root. Close development mode and return to the latest release. If you brought out a new release of your development package, then you can directly start usign them."})}),"\n",(0,r.jsx)(a.h2,{id:"downgrade-project-dependencies",children:"downgrade project dependencies"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm downgrade <name> v<version>                    (not implemented)\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Evaluate in a package root. Downgrade a project dependency to a new specified or unspecied (newest possible) version."})}),"\n",(0,r.jsx)(a.h2,{id:"register-a-new-release-of-a-project",children:"register a new release of a project"}),"\n",(0,r.jsx)(a.p,{children:"Its easy to publish new releases of your projects"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm release v<version>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsxs)(a.em,{children:["Evaluate in a package root. Publish a new release to your remote repository with version tag ",(0,r.jsx)(a.code,{children:"<version>"}),". The version number in your project file is updated automatically. The version name needs to adhere to semantic versioning and needs to be greater than the previous version. An error is thrown if the current version already exists in the registry. The remote is updated automatically."]})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm release --patch\ncosm release --minor\ncosm release --major\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsxs)(a.em,{children:["Evaluate in a package root. Convenience commands that publish a new ",(0,r.jsx)(a.code,{children:"patch"}),", ",(0,r.jsx)(a.code,{children:"minor"}),", or ",(0,r.jsx)(a.code,{children:"major"})," version. An error is thrown if the current version already exists in the registry. The package and registry remotes are updated automatically."]})}),"\n",(0,r.jsx)(a.h2,{id:"register-a-project-to-a-registry",children:"Register a project to a registry"}),"\n",(0,r.jsx)(a.p,{children:"Once you have published one or more releases to your remote repository, you can add them to a registry as follows"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm registry add <registry name> v<version tag> <giturl>\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Can be evaluated anywhere. Register a package version to a registry (in .cosm/registries). An error is thrown if the current version already exists in the registry. The remote repository of the registry is updated automatically."})}),"\n",(0,r.jsx)(a.h2,{id:"remove-a-version-or-project-from-a-registry",children:"Remove a version or project from a registry"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cosm registry rm <registry name> <package name> [--force]\ncosm registry rm <registry name> <package name> v<version> [--force]\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"Remove a version of a package or a package entirely from the registry (in .cosm/registries). The remote repository of the registry is updated automatically."})})]})}function h(e={}){const{wrapper:a}={...(0,i.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>t,x:()=>o});var s=n(6540);const r={},i=s.createContext(r);function t(e){const a=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(i.Provider,{value:a},e.children)}}}]);