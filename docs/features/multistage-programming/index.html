<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-features/multistage-programming" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Multistage programming | The Terra Programming Language</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/terra-website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/terra-website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/terra-website/docs/features/multistage-programming"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Multistage programming | The Terra Programming Language"><meta data-rh="true" name="description" content="Terra is a low-level system programming language that is embedded in and meta-programmed by the Lua programming language:"><meta data-rh="true" property="og:description" content="Terra is a low-level system programming language that is embedded in and meta-programmed by the Lua programming language:"><link data-rh="true" rel="icon" href="/terra-website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/terra-website/docs/features/multistage-programming"><link data-rh="true" rel="alternate" href="https://github.com/terra-website/docs/features/multistage-programming" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/terra-website/docs/features/multistage-programming" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/terra-website/blog/rss.xml" title="The Terra Programming Language RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/terra-website/blog/atom.xml" title="The Terra Programming Language Atom Feed"><link rel="stylesheet" href="/terra-website/assets/css/styles.a8638691.css">
<script src="/terra-website/assets/js/runtime~main.62af43de.js" defer="defer"></script>
<script src="/terra-website/assets/js/main.99c38256.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/terra-website/img/terra-logo-light.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/terra-website/"><div class="navbar__logo"><img src="/terra-website/img/terra-logo-light.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/terra-website/img/terra-logo-light.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a><a href="https://github.com/terralang/terra/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Download<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/terra-website/docs/getting-started/intro">About</a><a class="navbar__item navbar__link" href="/terra-website/docs/getting-started/intro">Getting started</a><a class="navbar__item navbar__link" href="/terra-website/docs/getting-started/intro">Documentation</a><a class="navbar__item navbar__link" href="/terra-website/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/terralang/terra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Multistage programming</h1></header>
<p><strong>Terra</strong> is a low-level system programming language that is embedded in and meta-programmed by the <strong>Lua</strong> programming language:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>Try this example and others in your browser via <a href="https://replit.com/@terralang/terra" target="_blank" rel="noopener noreferrer">Replit</a>.</p>
<p>Like C/C++, Terra is a  <strong>statically-typed</strong>, <strong>compiled language</strong> with manual memory management.
But unlike C/C++, it is designed from the beginning to be <strong>meta-programmed from Lua</strong>.</p>
<p>The design of Terra comes from the realization that C/C++ is really composed of multiple &quot;languages.&quot; It has a core language of operators, control-flow, and functions calls, but surrounding this language is a meta-language composed of a mix of features such as the pre-processor, templating system, and struct definitions. Templates alone are Turing-complete and have been used to produce optimized libraries such as <a href="http://eigen.tuxfamily.org/index.php?title=Main_Page" target="_blank" rel="noopener noreferrer">Eigen</a>, but are horrible to use in practice.</p>
<p>In Terra, we just gave in to the trend of making the meta-language of C/C++ more powerful and replaced it with a real programming language, Lua.</p>
<p>The combination of a low-level language meta-programmed by a high-level scripting language allows many behaviors that are not possible in other systems. Unlike C/C++, Terra code can be JIT-compiled and run interleaved with Lua evaluation, making it easy to write software libraries that depend on runtime code generation.</p>
<p>Features of other languages such as conditional compilation and templating simply fall out of the combination of using Lua to meta-program Terra:</p>
<div style="display:flex;gap:1rem;flex-wrap:wrap"><div style="flex:1;min-width:300px"><div style="color:var(--ifm-font-color-base);padding:0.5rem 1rem;border-radius:var(--ifm-pre-border-radius, 4px) var(--ifm-pre-border-radius, 4px) 0 0;border-bottom:none;font-size:0.9rem;font-weight:bold">Terra</div><div style="margin-top:0;border-radius:0 0 var(--ifm-pre-border-radius, 4px) var(--ifm-pre-border-radius, 4px);overflow:hidden"><div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div></div></div><div style="flex:1;min-width:300px"><div style="color:var(--ifm-font-color-base);padding:0.5rem 1rem;border-radius:var(--ifm-pre-border-radius, 4px) var(--ifm-pre-border-radius, 4px) 0 0;border-bottom:none;font-size:0.9rem;font-weight:bold">C++</div><div style="margin-top:0;border-radius:0 0 var(--ifm-pre-border-radius, 4px) var(--ifm-pre-border-radius, 4px);overflow:hidden"><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>Conditional compilation is done with control-flow that determines what code is defined.</p>
<div style="display:flex;gap:1rem;flex-wrap:wrap"><div style="flex:1;min-width:300px"><div style="margin-top:inherit;border-radius:var(--ifm-pre-border-radius, 4px);overflow:hidden"><div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div></div></div><div style="flex:1;min-width:300px"><div style="margin-top:inherit;border-radius:var(--ifm-pre-border-radius, 4px);overflow:hidden"><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">ifdef</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">_WIN32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">waitatend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">getchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">waitatend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>Templates become Lua functions that take a terra type T and use it to generate new types and code.</p>
<div style="display:flex;gap:1rem;flex-wrap:wrap"><div style="flex:1;min-width:300px"><div style="margin-top:inherit;border-radius:var(--ifm-pre-border-radius, 4px);overflow:hidden"><div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div></div></div><div style="flex:1;min-width:300px"><div style="margin-top:inherit;border-radius:var(--ifm-pre-border-radius, 4px);overflow:hidden"><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">template</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Array</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> N</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    T</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    T </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">float</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> FloatArray</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-you-use-terra">How can you use Terra?<a href="#how-can-you-use-terra" class="hash-link" aria-label="Direct link to How can you use Terra?" title="Direct link to How can you use Terra?">​</a></h2>
<p>Terra is a statically-typed, compiled language that interoperates seamlessly with Lua. In this setup, Lua acts as the high-level meta-programming layer, while Terra handles the low-level, performance-critical code. The two languages share a lexical environment, meaning Terra code is written within Lua programs, and Lua can dynamically generate and manipulate Terra code at runtime. You can use Terra and Lua in the followind way ...</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-embedded-jit-compiler-for-building-languages">An embedded JIT-compiler for building languages<a href="#an-embedded-jit-compiler-for-building-languages" class="hash-link" aria-label="Direct link to An embedded JIT-compiler for building languages" title="Direct link to An embedded JIT-compiler for building languages">​</a></h3>
<p>We use techniques from <a href="https://en.wikipedia.org/wiki/Multi-stage_programming" target="_blank" rel="noopener noreferrer">multi-stage programming</a> to make it possible to  <a href="#generative-programming">meta-program</a> Terra using Lua.  Terra expressions, types, and functions are all first-class Lua values, making it possible to generate arbitrary programs at runtime. This allows you to <a href="#compiling-a-language">compile domain-specific languages</a> (DSLs) written in Lua into high-performance Terra code. Furthermore, since Terra is built on the Lua ecosystem, it is easy to <a href="#embedding-and-interoperability">embed</a> Terra-Lua programs in other software as a library. This design allows you to add a JIT-compiler into your existing software. You can use it to add a JIT-compiled DSL to your application, or to auto-tune high-performance code dynamically.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-scripting-language-with-high-performance-extensions">A scripting-language with high-performance extensions<a href="#a-scripting-language-with-high-performance-extensions" class="hash-link" aria-label="Direct link to A scripting-language with high-performance extensions" title="Direct link to A scripting-language with high-performance extensions">​</a></h3>
<p>While the performance of Lua and other dynamic languages is always getting better, a low-level of abstraction gives you predictable control of performance when you need it. Terra programs use the same LLVM backend that Apple uses for its C compilers. This means that Terra code performs similarly to equivalent C code. Terra also includes built-in support for SIMD operations, and other low-level features like non-temporal writes and prefetches. You can use Lua to organize and configure your application, and then call into Terra code when you need controllable performance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-stand-alone-low-level-language">A stand-alone low-level language<a href="#a-stand-alone-low-level-language" class="hash-link" aria-label="Direct link to A stand-alone low-level language" title="Direct link to A stand-alone low-level language">​</a></h3>
<p>Terra was designed so that it can run independently from Lua. In fact, if your final program doesn&#x27;t need Lua, you can save Terra code into a .o file or executable. In addition to ensuring a clean separation between high- and low-level code, this design lets you use Terra as a stand-alone low-level language. In this use-case, Lua serves as a powerful meta-programming language.  Here it serves as a replacement for C++ <a href="https://en.wikipedia.org/wiki/Template_metaprogramming" target="_blank" rel="noopener noreferrer">template metaprogramming</a> or C preprocessor <a href="https://en.wikipedia.org/wiki/X_macro" target="_blank" rel="noopener noreferrer">X-Macros</a> with better syntax and nicer properties such as <a href="https://en.wikipedia.org/wiki/Hygienic_macro" target="_blank" rel="noopener noreferrer">hygiene</a>. Since Terra exists <em>only</em> as code embedded in a Lua meta-program, features that are normally built into low-level languages can be implemented as Lua libraries. This design keeps the core of Terra simple, while enabling powerful behavior such as conditional compilation, namespaces, templating, and even <strong>class systems</strong> <strong><a href="#simplicity">implemented as libraries</a></strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generative-programming">Generative Programming<a href="#generative-programming" class="hash-link" aria-label="Direct link to Generative Programming" title="Direct link to Generative Programming">​</a></h2>
<p>Terra entities such as functions, types, variables and expressions are first-class Lua values --- they can be stored in Lua variables and passed to or returned from Lua functions. Using constructs from multi-stage programming<a href="#footnote2"><sup>2</sup></a>, you can write Lua code to programmatically generate arbitrary Terra code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-stage-operators">Multi-stage operators<a href="#multi-stage-operators" class="hash-link" aria-label="Direct link to Multi-stage operators" title="Direct link to Multi-stage operators">​</a></h3>
<p>Inside Terra code, you can use an <em>escape</em> operator (<code>[]</code>) to splice the result of a Lua expression into the Terra code:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>An escape is evaluated when a Terra function is <em>compiled</em>, and the result is spliced into the Terra code. In this example, this means that <code>math.sin(5)</code> will be evaluated <em>once</em> and the code that implements the Terra function will return a constant. This can be verified by printing out the compiled version of the <code>sin5</code> function:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>Escapes can also return other Terra entities such as a function:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>In this case, Terra will insert a call to the Terra function stored in the <code>add4</code> variable:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>In fact, <em>any</em> name used in Terra code such as <code>add4</code> or <code>foo.bar</code> is treated as if it were escaped by default.</p>
<p>Inside an escape, you can refer to variables defined in Terra:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>Since escapes are evaluated before a Terra function is compiled, variables <code>a</code> and <code>b</code> will not have concrete integer values inside the escape. Instead, inside the Lua code <code>a</code> and <code>b</code> are Terra <em>symbols</em> that represent references to Terra values. Since <code>choosesecond</code> returns the symbol <code>b</code>, the <code>example</code> function will return the value of Terra variable <code>b</code> when called.</p>
<p>The <em>quotation</em> operator (a backtick) allows you to generate Terra statements and expression in Lua. They can then be spliced into Terra code using the escape operator.</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>To generate statements rather than expressions you can use the <code>quote</code> operator:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-a-language">Compiling-a-language<a href="#compiling-a-language" class="hash-link" aria-label="Direct link to Compiling-a-language" title="Direct link to Compiling-a-language">​</a></h3>
<p>With these two operators, you can use Lua to generate <em>arbitrary</em> Terra code at compile-time. This makes the combination of Lua/Terra well suited for writing compilers for high-performance domain-specific languages. For instance, we can implement a <em>compiler</em> for <a href="http://en.wikipedia.org/wiki/Brainfuck" target="_blank" rel="noopener noreferrer">BF</a>, a minimal language that emulates a Turing machine. The Lua function <code>compile</code> will take a string of BF code, and a maximum tape size <code>N</code>. It then generates a Terra function that implements the BF code. Here is a skeleton that sets up the BF program:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>The function <code>body</code> is responsible for generating body of the BF program given the code string:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>It loops over the code string, and generates the corresponding Terra code for each character of BF (e.g. &quot;&gt;&quot; shifts the tape over by 1 and is implemented by the Terra code <code>ptr = ptr + 1</code>). We can now compile a BF function:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>The result, <code>add3</code>, is a Terra function that adds3 to an input character and then prints it out:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>We can also use <code>goto</code> statements (<code>goto labelname</code>) and labels (<code>::labelname::</code>) to implement BF&#x27;s looping construct:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>We are using these generative programming constructs to implement domain-specific languages and auto-tuners: check out our <a href="/terra-website/publications.html">PLDI paper</a> that describes our implementation of Orion, a language for image processing kernels, and <a href="http://ebblang.org/" target="_blank" rel="noopener noreferrer">Ebb</a>, which is a DSL for solving mesh-based PDE&#x27;s in Terra.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="embedding-and-interoperability">Embedding-and-interoperability<a href="#embedding-and-interoperability" class="hash-link" aria-label="Direct link to Embedding-and-interoperability" title="Direct link to Embedding-and-interoperability">​</a></h2>
<p>Programming languages don&#x27;t exist in a vacuum, and the generative programming features of Terra can be useful even in projects that are primarily implemented in other programming languages. We make it possible to integrate Terra with other projects so you can use it to generate low-level code, while keeping most of your project in a well-established language.</p>
<p>First, we make it possible to pass values between Lua and Terra. Our implementation is built on top of LuaJIT&#x27;s <a href="http://luajit.org/ext_ffi_tutorial.html" target="_blank" rel="noopener noreferrer">foreign fuction interface</a>. You can call Terra functions directly from Lua (or vice-versa), and access Terra objects directly from Lua (more details in the <a href="/terra-website/api.html#converting-between-lua-values-and-terra-values">API reference</a>).</p>
<p>Furthermore, Lua-Terra is backwards compatible with both pure Lua and C, which makes it easy to use preexisting code. In Lua-Terra, you can use <code>require</code> or <code>loadfile</code> and it will treat the file as a Lua program (use <code>terralib.loadfile</code> to load a combined Lua-Terra file). You can use <code>terralib.includec</code> to import C functions from already existing header files.</p>
<p>Finally, Lua-Terra can also be <em>embedded</em> in pre-existing applications by linking the application against <code>libterra.a</code> and using Terra&#x27;s C API. The interface is very similar to that of the <a href="http://queue.acm.org/detail.cfm?id=1983083" target="_blank" rel="noopener noreferrer">Lua interpreter</a>. A simple example initializes Terra and then runs code from the file specified in each argument:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;terra.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lua_State </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> L </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">luaL_newstate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//create a plain lua state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">luaL_openlibs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//initialize its libraries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//initialize the terra state in lua</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">terra_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//run the terra code in each file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">terra_dofile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">L</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="simplicity">Simplicity<a href="#simplicity" class="hash-link" aria-label="Direct link to Simplicity" title="Direct link to Simplicity">​</a></h2>
<p>The combination of a simple low-level language with a simple dynamic programming language means that many built-in features of statically-typed low-level languages can be implemented as libraries in the dynamic language. Here are just a few examples:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conditional-compilation">Conditional Compilation<a href="#conditional-compilation" class="hash-link" aria-label="Direct link to Conditional Compilation" title="Direct link to Conditional Compilation">​</a></h3>
<p>Normally conditional compilation is accomplished using preprocessor directives (e.g., <code>#ifdef</code>), or custom build systems. Using Lua-Terra, we can write Lua code to decide how to construct a Terra function. Since Lua is a full programming language, it can do things that most preprocessors cannot, such as call external programs. In this example, we conditionally compile a Terra function differently on OSX and Linux by first calling <code>uname</code> to discover the operating system, and then using an <code>if</code> statement to instantiate a different version of the Terra function depending on the result:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="namespaces">Namespaces<a href="#namespaces" class="hash-link" aria-label="Direct link to Namespaces" title="Direct link to Namespaces">​</a></h3>
<p>Statically-typed languages normally need constructs that specifically deal with the problem of namespaces (e.g., C++&#x27;s <code>namespace</code> keyword, or Java&#x27;s <code>import</code> constructs). For Terra, we just use Lua&#x27;s first-class tables as way to organize functions. When you use any &quot;name&quot; such as <code>myfunctions.add</code> inside a Terra function, the Terra will resolve it at <em>compile time</em> to the Terra value it holds. Here is an example of placing a Terra function inside a Lua table, and then calling it from another Terra function:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>In fact, you&#x27;ve already seen this behavior when we imported C functions:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>The function <code>includec</code> just returns a Lua table (<code>C</code>) that contains the C functions. Since <code>C</code> is a Lua table, you can iterate through it if you want:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="templating">Templating<a href="#templating" class="hash-link" aria-label="Direct link to Templating" title="Direct link to Templating">​</a></h3>
<p>Since Terra types and functions are first class values, you can get functionality similar to a C++ template by simply creating a Terra type and defining a Terra function <em>inside</em> of a Lua function. Here is an example where we define the Lua function <code>MakeArray(T)</code> which takes a Terra type <code>T</code> and generates an <code>Array</code> object that can hold multiple <code>T</code> objects (i.e. a simple version of C++&#x27;s <code>std::vector</code>).</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>As shown in this example, Terra allows you to define methods on <code>struct</code> types.
Unlike other statically-typed languages with classes, there are no built-in mechanisms for inheritance or runtime polymorphism.
Methods declarations are just a syntax sugar that associates table of Lua methods with each type. Here the <code>get</code> method is equivalent to:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>The object <code>ArrayT.methods</code> is a Lua table that holds the methods for type <code>ArrayT</code>.</p>
<p>Similarly an invocation such as <code>ia:get(0)</code> is equivalent to <code>T.methods.get(&amp;ia,0)</code>.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="specialization">Specialization<a href="#specialization" class="hash-link" aria-label="Direct link to Specialization" title="Direct link to Specialization">​</a></h3>
<p>By nesting a Terra function inside a Lua function, you can compile different versions of a function. Here we generate different versions
of the power function (e.g. pow2, or pow3):</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="class-systems">Class Systems<a href="#class-systems" class="hash-link" aria-label="Direct link to Class Systems" title="Direct link to Class Systems">​</a></h3>
<p>As shown in the templating example, Terra allows you to define methods on <code>struct</code> types but does not provide any built-in mechanism for inheritance or polymorphism. Instead, normal class systems can be written as libraries.  For instance, a user might write:</p>
<div class="terra-code-container" style="position:relative"><pre class="language-terra"><code></code></pre><button class="terra-copy-btn" aria-label="Copy code to clipboard"><svg viewBox="0 0 24 24" class="copy-icon"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copied-icon"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></button></div>
<p>The functions <code>J.extends</code> and <code>J.implements</code> are Lua functions that generate the appropriate Terra code to implement a class system. More information is available in our <a href="/terra-website/publications.html">PLDI Paper</a>. The file <a href="https://github.com/terralang/terra/blob/master/tests/lib/javalike.t" target="_blank" rel="noopener noreferrer">lib/javalike.t</a> has one possible implementation of a Java-like class system, while the file <a href="https://github.com/terralang/terra/blob/master/tests/lib/golike.t" target="_blank" rel="noopener noreferrer">lib/golike.t</a> is more similar to Google&#x27;s Go language.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/features/multistage-programming.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-can-you-use-terra" class="table-of-contents__link toc-highlight">How can you use Terra?</a><ul><li><a href="#an-embedded-jit-compiler-for-building-languages" class="table-of-contents__link toc-highlight">An embedded JIT-compiler for building languages</a></li><li><a href="#a-scripting-language-with-high-performance-extensions" class="table-of-contents__link toc-highlight">A scripting-language with high-performance extensions</a></li><li><a href="#a-stand-alone-low-level-language" class="table-of-contents__link toc-highlight">A stand-alone low-level language</a></li></ul></li><li><a href="#generative-programming" class="table-of-contents__link toc-highlight">Generative Programming</a><ul><li><a href="#multi-stage-operators" class="table-of-contents__link toc-highlight">Multi-stage operators</a></li><li><a href="#compiling-a-language" class="table-of-contents__link toc-highlight">Compiling-a-language</a></li></ul></li><li><a href="#embedding-and-interoperability" class="table-of-contents__link toc-highlight">Embedding-and-interoperability</a></li><li><a href="#simplicity" class="table-of-contents__link toc-highlight">Simplicity</a><ul><li><a href="#conditional-compilation" class="table-of-contents__link toc-highlight">Conditional Compilation</a></li><li><a href="#namespaces" class="table-of-contents__link toc-highlight">Namespaces</a></li><li><a href="#templating" class="table-of-contents__link toc-highlight">Templating</a></li><li><a href="#specialization" class="table-of-contents__link toc-highlight">Specialization</a></li><li><a href="#class-systems" class="table-of-contents__link toc-highlight">Class Systems</a></li></ul></li></ul></div></div></div><div class="navigationContainer_MZYS"><div class="navArrows_zGQG"><a class="navLink_khJ7" href="/terra-website/docs/features/script-with-c-performance">← Previous</a><span class="spacer_eUuD"></span><a class="navLink_khJ7" href="/terra-website/docs/features/backwards-compatible-with-c">Next →</a></div><a class="homeLink_Zq3u" href="/terra-website/">Back to Home</a></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/terra-website/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/terra-website/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/terralang/terra" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Terralang.</div></div></div></footer></div>
</body>
</html>